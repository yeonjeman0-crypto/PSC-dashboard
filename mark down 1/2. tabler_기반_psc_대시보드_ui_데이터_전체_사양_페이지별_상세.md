# ① 제목
Tabler(dev, GitHub) 기반 PSC 대시보드 UI·데이터 전체 사양서 v1.0  
최신 확인 완료(2025-08-23, Asia/Seoul)

---

# ② 핵심 요약(3~5줄)
- 오픈소스 **tabler-dev**(Bootstrap 5, ApexCharts, Tabler Icons)를 기준으로 **카드 중심 레이아웃**으로 구성합니다.
- 네비게이션은 `Dashboard / Inspections / Deficiencies / Vessels / Ports Map / Risk / Reports / Settings` 8개 화면으로 고정합니다.
- 데이터는 **Master/Fact/Derived** 3계층 스키마로 표준화하고, KPI·차트·히트맵·리스크 산식을 명문화합니다.
- 색상·타이포·간격·컴포넌트 규칙과 페이지별 위젯 배치·상호작용을 상세 정의합니다.

---

# ③ 상세 내용

## 3.1 기술 기준
- UI 프레임워크: **Tabler**(Bootstrap 5 기반)
- 차트: **ApexCharts**(Tabler 문서 연동 용이)
- 아이콘: **Tabler Icons**
- 페이지 빌드: Tabler 기본 빌드(정적 HTML) → `/dist/*.html` 배포
- 데이터 로딩: `fetch()`로 JSON(`/assets/data/*.json`) 또는 추후 API(`/stats/*`) 전환

## 3.2 네비게이션 구조(전역)
- 상단 Navbar: 로고, 전역 기간 선택기(최근 12개월 기본), 전역 필터 버튼, 프로필 메뉴
- 좌측 Sidebar:
  1) **Dashboard**(`/psc-dashboard.html`)
  2) **Inspections**(`/inspections.html`)
  3) **Deficiencies**(`/deficiencies.html`)
  4) **Vessels**(`/vessels.html`)
  5) **Ports Map**(`/ports.html`)
  6) **Risk**(`/risk.html`)
  7) **Reports**(`/reports.html`)
  8) **Settings**(`/settings.html`)

## 3.3 데이터 계층·스키마
### A) Master(기준)
- `vessels.json`  
`{ imo:number, name:string, type:"PCC"|"PCTC"|"BULK"|..., owner:string, flag:string(ISO3), dwt:number, builtYear:number }`
- `ports.json`  
`{ locode:string(5), countryCode:string(2), countryName:string, portCode:string(3), portName:string, isPort:boolean }`
- `actionCodes.json`  
`{ code:string, description:string, category:string, urgency:"info"|"normal"|"critical", labelKo?:string }`
- `defCodes.json`(선택)  
`{ code:string, title:string, category:string }`

### B) Fact(사실)
- `inspections.json`  
`{ id:string, date:"YYYY-MM-DD", imo:number, mou:"Tokyo"|"Paris"|"USCG"|"Indian", countryCode:string, locode:string(5), actionCode:string, detained:boolean }`
- `deficiencies.json`  
`{ inspectionId:string, code:string, remark?:string, convention?:string }`

### C) Derived(파생)
- `riskSnapshots.json`  
`{ date:"YYYY-MM", imo:number, score:number(0~100), ageFactor:number, historyFactor:number, mouFactor:number }`
- `kpiCache.json`(선택)  
`{ period:"YYYY-MM..YYYY-MM", scope:{filters..}, kpis:{...}, ttl:iso }`

### D) 경로 규칙
- 개발: `src/assets/data/*.json`  → 빌드: `dist/assets/data/*.json`
- 상수: `DATA_PATHS = { fleet, ports, actions, inspections, deficiencies, defCodes, risk }`

## 3.4 계산 로직(정의·산식·반올림)
### KPI(대시보드 상단 3×3)
- **Total Inspections** = `|inspections|`
- **Total Deficiencies** = `|deficiencies|`
- **Deficiency Rate(%)** = `(|deficiencies| / |inspections|) × 100` → 소수 1자리
- **Detentions** = `count(inspections.detained = true)`
- **Detention Rate(%)** = `(Detentions / |inspections|) × 100` → 소수 1자리
- **Ships Inspected** = `count(distinct inspections.imo)`
- **Avg Def./Vessel** = `|deficiencies| / Ships Inspected` → 소수 2자리
- **Top Def. Code** = `mode(deficiencies.code)`
- **High-Risk Ships** = `count(riskSnapshots.score ≥ 70)`

### 차트·지도·히트테이블
- **Top Deficiency Codes(막대, 상위 10)**: `groupBy(deficiencies.code).count` TOP 10
- **Funnel(검사→결함→출항정지)**: `[|inspections|, |deficiencies|, Detentions]`  
  ※ ApexCharts 퍼널 미지원 → donut/bar로 대체
- **Heat Table(월×MOU, 결함률)**: 행=월 `YYYY-MM`, 열=`mou`, 값=`(월별 def / 월별 insp)×100`
- **Ports Map(버블/컬러)**: 버블=√검사수, 색=Detention Rate 구간색

### 리스크 스코어(0–100)
`score = clamp(100 * (0.4*A + 0.4*H + 0.2*M))`
- `A` = `min(1, (nowYear - builtYear)/30)`
- `H` = `normalize(defPerInsp, 0→0, 1.5→1)` with `defPerInsp = recentDef / recentInsp (24M)`
- `M` = `baselineDetentionRate(mou)` 정규화(0~1)
- 등급: `ProbabilityGrade = ceil(H×5)`, `Seriousness grade = ceil((0.6*A + 0.4*M)×5)`, `Risk rating = Prob × Seriousness (1~25)`

## 3.5 색상·타이포·간격·아이콘
### 색상 팔레트(토큰)
- Light 배경: `#f1f5f9` / Dark 배경: `#0f172a`
- Inspections: **Indigo `#6366f1`**
- Deficiencies: **Rose `#f43f5e`**
- Detention: **Violet `#8b5cf6`**
- Risk: **Amber `#f59e0b`**
- Success: **Emerald `#10b981`**
- 상태 라벨: Detained=true → Violet 칩 강조, Action `17` 등 긴급 → Rose 칩

### SCSS 변수(예시)
```scss
$primary: #6366f1; // indigo
$danger:  #f43f5e; // rose
$warning: #f59e0b; // amber
$success: #10b981; // emerald
$body-bg: #0f172a; // dark 기본 (light 테마는 #f1f5f9)
$card-border-radius: 1rem; // rounded-2xl 느낌
```

### 컴포넌트 스타일 규칙
- Card: `.card > .card-body` 사용, `card-title`로 섹션 타이틀 표기
- Grid: `.row.row-deck` + `.col-sm-6 .col-lg-4`로 KPI 3×3 구성
- Table: `.table.table-vcenter` + 가상 스크롤 컨테이너 `.table-responsive`
- Badge/Chip: `.badge`, `.status`(Tabler 유사 클래스)로 상태 강조
- Icon: Tabler Icons(`ti ti-...`), KPI 아이콘은 좌상 원형 배경 포함 가능

### 접근성·반응형
- 대비비 4.5:1 이상, 포커스 링 유지
- xs~xl 그리드 재배치: 모바일 1열 → 데스크톱 3열

---

# ④ 페이지별 화면 설계(상세)

## 4.1 Dashboard — `/psc-dashboard.html`
**레이아웃**
- 상단 KPI 3×3(9카드)
- 본문 2열: [좌] Ports Map 카드, [우] Top Def. Bar + Funnel 카드 2개 세로 스택
- 하단: Heat Table 카드

**위젯**
- KPI(9): Total Inspections, Total Deficiencies, Deficiency Rate, Detentions, Detention Rate, Ships Inspected, Avg Def./Vessel, Top Def. Code, High-Risk Ships
- Ports Map: 버블=검사수, 색=Detention Rate
- Bar: Top10 Deficiency Codes
- Funnel 대체(donut): Inspections vs Deficiencies vs Detentions
- Heat Table: 월×MOU 결함률

**상호작용**
- KPI 클릭 → 해당 지표 기준 필터를 유지한 채 상세 화면 이동(예: Top Def. Code → `/deficiencies.html?code=05106`)
- 지도 버블 클릭 → `/inspections.html?locode=KRPNK`
- 막대 클릭 → `/deficiencies.html?code=XXXX`

**색상**
- KPI 카드 그라데이션(옵션): Indigo/Rose/Violet/Amber 계열 한정 사용
- 차트 기본색: 위 토큰 컬러를 series에 매핑(Inspections=Indigo, Deficiencies=Rose, Detention=Violet)

---

## 4.2 Inspections — `/inspections.html`
**헤더 KPI(4)**: Inspections, Detentions, Detention Rate, Ships

**필터 바**: 기간, MOU, 국가, 항만(LOCODE), 액션코드

**테이블(메인)**
- 컬럼: Date, MOU, Country, Port(LOCODE), IMO, Vessel, Action, Detained
- 정렬: Date desc 기본, 컬럼별 정렬·필터 가능
- Row 클릭 → 우측 상세 패널(Drawer)

**상세 패널**
- 헤더: `IMO, Vessel, Date, Port`
- 섹션1: 결함 리스트(해당 inspectionId의 deficiencies)
- 섹션2: 액션코드 설명(actionCodes 매핑)
- 섹션3: 최근 12개월 검사 타임라인(스파크라인)

**색상·상태**
- Detained=true → Violet 배지, Action 긴급도 critical → Rose 배지

---

## 4.3 Deficiencies — `/deficiencies.html`
**좌**: Top10 Def. Bar(월 탭)

**우**: 코드별 추이 Line + 카테고리 분포 Donut

**하단 테이블**
- 컬럼: Date, MOU, LOCODE, IMO, Code, Title, Remark, Convention
- 코드 hover → defCodes.title 툴팁

**필터**: 코드, 카테고리, MOU, 기간

**색상**: Bar/Line/Donut에 Rose 계열 중심, 카테고리는 카테고리별 보조색 자동 배정

---

## 4.4 Vessels — `/vessels.html`
**헤더 KPI(4)**: Fleet Size, Avg Age, ≥20y, High-Risk Ships

**테이블(리스트)**
- 컬럼: IMO, Name, Type, Flag, Built, DWT, Insp(12M), Def(12M), Risk score
- 정렬·검색: IMO/Name/Type/Flag

**행 클릭 → 모달**
- 좌: 선박 기본 스펙
- 우상: 최근 24M 검사·결함 라인 그래프
- 우하: 위험도 요인 분해(A/H/M), 현재 등급 배지

**색상**: Risk score 구간색(Score 0~100 → Green→Amber→Red)

---

## 4.5 Ports Map — `/ports.html`
**지도 카드**: 버블=검사수, 색=Detention Rate(연속 팔레트)

**우측 요약 패널**
- KPI: Inspections, Def., Detentions, Detention Rate
- 표: 최근 6개월 항만별 추이

**상호작용**
- 버블 클릭 → 패널 갱신, “상세 보기” 버튼 → `/inspections.html?locode=XXX`

**색상**: 낮은율=Indigo 밝게, 높은율=Violet 강조(연속 스케일)

---

## 4.6 Risk — `/risk.html`
**좌**: 위험도 랭킹 테이블(Top 50)
- 컬럼: Rank, IMO, Name, Type, Age, Insp(24M), Def./Insp, MOU baseline, Score, Risk rating

**우**: 5×5 리스크 매트릭스(Probability × Seriousness) Heatmap

**시나리오 버튼**: 교육·정비 가정 적용 → H 20% 감소, 재계산 비교(전/후 배지)

**색상**: Heatmap Amber→Rose 그라데이션, 높은 위험도 진한 Rose/Violet

---

## 4.7 Reports — `/reports.html`
**프리셋**: 월간 요약, 분기 트렌드, MOU 비교, Def. Top10

**출력**: PDF/CSV, 헤더에 기간·필터 확정 값 고정 표기

**서명/비고** 블록 포함

---

## 4.8 Settings — `/settings.html`
**데이터/엔드포인트 설정**: `DATA_PATHS` 편집 UI, API URL 스위치

**브랜딩**: 로고 업로드, 색상 토큰 변경(SCSS 변수)

**권한**: 보기/다운로드 권한 레벨

---

# ⑤ 표·리스트

## A. KPI·위젯 매핑 요약
| 페이지 | 상단 KPI | 본문 차트/지도 | 하단 | 주요 필터 | 클릭 이동 |
|---|---|---|---|---|---|
| Dashboard | 9개 | 지도 / Top10 Bar, Funnel | Heat Table | 기간·MOU·국가/항만·선종·선령 | 지도→Inspections, Bar→Deficiencies |
| Inspections | 4개 | — | 상세 테이블 | 기간·MOU·국가·항만·액션 | 행→상세패널 |
| Deficiencies | 2개 | Bar, Line, Donut | 테이블 | 코드·카테고리·MOU | 코드→툴팁/필터 |
| Vessels | 4개 | 히스토그램·Donut | 랭킹 테이블 | 선종·선령·국기 | 행→모달 |
| Ports Map | 4개 | 지도 | 월간 추이 표 | 국가·항만 | 버블→Inspections |
| Risk | — | Heatmap | 랭킹 테이블 | 선종·선령 | 행→Vessel 상세 |
| Reports | — | 프리셋 그래프 | PDF/CSV | 기간 | — |
| Settings | — | — | 폼 | — | — |

## B. 핵심 테이블 컬럼 사양
| 화면 | 컬럼 | 타입/예시 | 정렬/필터 |
|---|---|---|---|
| Inspections | Date | 2025-08-23 | 정렬 O, 기간 필터 |
|  | MOU | Tokyo | 필터 O |
|  | Country | KR | 필터 O |
|  | Port(LOCODE) | KRPNK | 필터 O |
|  | IMO | 9310678 | 검색 O |
|  | Vessel | WOORI SUN | 검색 O |
|  | Action | 17 | 필터 O |
|  | Detained | true/false | 필터 O |
| Deficiencies | Date, MOU, LOCODE, IMO, Code, Title, Remark, Convention | — | 코드·카테고리 필터 |
| Vessels | IMO, Name, Type, Flag, Built, DWT, Insp(12M), Def(12M), Risk | — | 다중 정렬 |

## C. 색상 토큰(요약)
| 용도 | HEX |
|---|---|
| 배경 Light | #f1f5f9 |
| 배경 Dark | #0f172a |
| Inspections | #6366f1 |
| Deficiencies | #f43f5e |
| Detention | #8b5cf6 |
| Risk | #f59e0b |
| Success | #10b981 |

## D. 리스크 등급표(5×5)
|  | Seriousness 1 | 2 | 3 | 4 | 5 |
|---|---|---|---|---|---|
| **Probability 1** | 1 | 2 | 3 | 4 | 5 |
| 2 | 2 | 4 | 6 | 8 | 10 |
| 3 | 3 | 6 | 9 | 12 | 15 |
| 4 | 4 | 8 | 12 | 16 | 20 |
| **5** | 5 | 10 | 15 | 20 | **25** |

---

# ⑥ 실행·배포 체크리스트
- [ ] `src/pages/*.html` 생성(8개)
- [ ] Navbar/Sidebar 메뉴 라벨·링크 연결
- [ ] `DATA_PATHS` 설정 및 `fetch()` 전환
- [ ] ApexCharts CDN 스크립트 포함
- [ ] SCSS 변수로 색상 토큰 반영 후 빌드
- [ ] `npm run build` → `dist/*.html` 검증

# ⑦ 비고
- MIT 라이선스 고지는 반드시 유지합니다.
- 코드 샘플과 SVG 아이콘 매핑은 차기 부록으로 추가 가능합니다.

